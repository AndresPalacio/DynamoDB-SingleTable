<p>Python DynamoDB interface, specialized in single-table design. DynamoDB
is high-performance serverless NoSQL, but difficult to disign tables.</p>
<p>Single-table design needs only single table, and few GSIs (Global
Secondary Indexes). It makes effective and easy to manage your whole
data models for single service.</p>
<div class="section" id="getting-started">
<h2>Getting Started</h2>
<div class="section" id="init-table">
<h3>Init Table</h3>
<pre><code><span class="kn">from</span> <span class="nn">ddb_single</span> <span class="kn">import</span> <span class="n">Table</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span>
    <span class="n">endpoint_url</span><span class="o">=</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">init</span><span class="p">()</span></code></pre>
</div>
<div class="section" id="data-models">
<h3>Data Models</h3>
<p>Each model has al least 3 keys - primary_key ? Hash key for single item.
default: <span class="docutils literal">pk: {__model_name__}_{uuid}</span> - seconday_key ? Range key for
item. default: <span class="docutils literal">sk: {__model_name__}_item</span> - unique_key ? key to
identify the item is the same. Mainly used to update item.</p>
<p>And you can set <span class="docutils literal">serch_key</span> to enable search via GSI</p>
<pre><code><span class="kn">from</span> <span class="nn">ddb_single</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">DBField</span><span class="p">,</span> <span class="n">FieldType</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">__table__</span><span class="o">=</span><span class="n">table</span>
    <span class="n">__model_name__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">DBField</span><span class="p">(</span><span class="n">unique_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">DBField</span><span class="p">(</span><span class="n">search_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">DBField</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">FieldType</span><span class="o">.</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">search_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span><span class="o">=</span><span class="n">DBField</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="section" id="usage">
<h2>Usage</h2>
<p>need ?Qurey? object for CRUD - <span class="docutils literal"><span class="pre">query.model(foo).create</span></span> -
<span class="docutils literal"><span class="pre">query.model(foo).get</span></span> - <span class="docutils literal"><span class="pre">query.model(foo).search</span></span> -
<span class="docutils literal"><span class="pre">query.model(foo).update</span></span> - <span class="docutils literal"><span class="pre">query.model(foo).delete</span></span></p>
<pre><code><span class="kn">from</span> <span class="nn">ddb_single</span> <span class="kn">import</span> <span class="n">Query</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">table</span><span class="p">)</span></code></pre>
<div class="section" id="create-item">
<h3>Create Item</h3>
<p>If the item with same value of <span class="docutils literal">unique_key</span> already exist, exist item
is updated.</p>
<pre><code><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&quot;john&#64;example.com&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">()</span></code></pre>
<p>Then, multible items added.</p>
<table>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr><th class="head"><p>pk</p></th>
<th class="head"><p>sk</p></th>
<th class="head"><p>data</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>email</p></th>
<th class="head"><p>des
cription</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>u
ser_xxxx</p></td>
<td><p>u
ser_item</p></td>
<td></td>
<td><p>John</p></td>
<td><p><a href="mailto:john&#37;&#52;&#48;exa">john<span>&#64;</span>exa</a>
mple.com</p></td>
<td><p>test</p></td>
</tr>
<tr><td><p>u
ser_xxxx</p></td>
<td><p>search_u
ser_name</p></td>
<td><p>John</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>u
ser_xxxx</p></td>
<td><p>s
earch_us
er_email</p></td>
<td><p>new-
<a href="mailto:john&#37;&#52;&#48;exa">john<span>&#64;</span>exa</a>
mple.com</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>In addition to main item (sk=<span class="docutils literal">user_item</span>), multiple item
(sk=<span class="docutils literal">search_{__model_name__}_{field_name}</span>) added to table. Those
?search items? are used to search</p>
<p>The GSI <span class="docutils literal">DataSearchIndex</span> is used to get ?search items? to extract
target?s pk. Then, <span class="docutils literal">batch_get</span> items by pk.</p>
<table>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr><th class="head"><p>sk = hash</p></th>
<th class="head"><p>data = range</p></th>
<th class="head"><p>pk</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>search_user_name</p></td>
<td><p>John</p></td>
<td><p>user_xxxx</p></td>
</tr>
<tr><td><p>search_user_email</p></td>
<td><p><a href="mailto:new-john&#37;&#52;&#48;example&#46;com">new-john<span>&#64;</span>example<span>&#46;</span>com</a></p></td>
<td><p>user_xxxx</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="search-items">
<h3>Search Items</h3>
<pre><code><span class="n">user</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="c1"># -&gt; [{&quot;pk&quot;:&quot;user_xxxx&quot;, &quot;sk&quot;:&quot;user_item&quot;, &quot;name&quot;:&quot;John&quot;, &quot;email&quot;:&quot;john&#64;example.com&quot;}]</span></code></pre>
<p><span class="docutils literal">pk_only=True</span> to extract pk without <span class="docutils literal">batch_get</span></p>
<pre><code><span class="n">user_pks</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">),</span> <span class="n">pk_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user_pks</span><span class="p">)</span>
<span class="c1"># -&gt; [&quot;user_xxxx&quot;]</span></code></pre>
</div>
<div class="section" id="get-single-item">
<h3>Get single item</h3>
<p><span class="docutils literal">get(pk)</span> to get single item.</p>
<pre>user = query.model(User).get(&quot;user_xxxx&quot;)
print(user)
# -&gt; {&quot;pk&quot;:&quot;user_xxxx&quot;, &quot;sk&quot;:&quot;user_item&quot;, &quot;name&quot;:&quot;John&quot;, &quot;email&quot;:&quot;john&#64;example.com&quot;}</pre>
<p><span class="docutils literal">get_by_unique</span> to get item by <span class="docutils literal">unique_key</span></p>
<pre><code><span class="n">user</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">get_by_unique</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="c1"># -&gt; {&quot;pk&quot;:&quot;user_xxxx&quot;, &quot;sk&quot;:&quot;user_item&quot;, &quot;name&quot;:&quot;John&quot;, &quot;email&quot;:&quot;john&#64;example.com&quot;}</span></code></pre>
<p><span class="docutils literal">pk_only=True</span> option in <span class="docutils literal">get_by_unique</span> to get <span class="docutils literal">primary key</span>
without <span class="docutils literal">get_item</span></p>
<pre><code><span class="n">pk</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">get_by_unique</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
<span class="c1"># -&gt; &quot;user_xxxx&quot;</span></code></pre>
</div>
<div class="section" id="update-item">
<h3>Update Item</h3>
<pre><code><span class="n">user</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s2">&quot;john&#64;example.com&quot;</span><span class="p">))</span>
<span class="n">new_user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="o">**</span><span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">new_user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;new-john&#64;example.com&quot;</span>
<span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">new_user</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></code></pre>
<p>Or use unique value to detect exist item.</p>
<pre><code><span class="n">new_user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&quot;new-john&#64;example.com&quot;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">new_user</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></code></pre>
<p>Then, tha value of ?main item? and ?seach item? changed</p>
<table>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr><th class="head"><p>pk</p></th>
<th class="head"><p>sk</p></th>
<th class="head"><p>data</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>email</p></th>
<th class="head"><p>des
cription</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>u
ser_xxxx</p></td>
<td><p>u
ser_item</p></td>
<td></td>
<td><p>John</p></td>
<td><p>new-
<a href="mailto:john&#37;&#52;&#48;exa">john<span>&#64;</span>exa</a>
mple.com</p></td>
<td><p>test</p></td>
</tr>
<tr><td><p>u
ser_xxxx</p></td>
<td><p>search_u
ser_name</p></td>
<td><p>John</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>u
ser_xxxx</p></td>
<td><p>s
earch_us
er_email</p></td>
<td><p>new-
<a href="mailto:john&#37;&#52;&#48;exa">john<span>&#64;</span>exa</a>
mple.com</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="delete-item">
<h3>Delete Item</h3>
<pre>user = query.model(User).search(User.email.eq(&quot;new-john&#64;example.com&quot;))
query.model(user[0]).delete()</pre>
<p><span class="docutils literal">primary key</span> to detect exist item.</p>
<pre>query.model(User).delete_by_pk(&quot;user_xxxx&quot;)</pre>
<p>or <span class="docutils literal">unique key</span></p>
<pre>query.model(User).delete_by_unique(&quot;John&quot;)</pre>
</div>
</div>
<div class="section" id="batch-writer">
<h2>Batch Writer</h2>
<p><span class="docutils literal">table.batch_writer()</span> to create/update/delete multible items -
<span class="docutils literal"><span class="pre">query.model(foo).create(batch=batch)</span></span> -
<span class="docutils literal"><span class="pre">query.model(foo).update(batch=batch)</span></span> -
<span class="docutils literal"><span class="pre">query.model(foo).delete(batch=batch)</span></span></p>
<div class="section" id="batch-create">
<h3>Batch Create</h3>
<pre><code><span class="k">with</span> <span class="n">table</span><span class="o">.</span><span class="n">batch_writer</span><span class="p">()</span> <span class="k">as</span> <span class="n">batch</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;test</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">begins_with</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">([(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">])</span>
<span class="c1"># -&gt; [(&quot;test0&quot;, 10), (&quot;test1&quot;, 11), (&quot;test2&quot;, 12)]</span></code></pre>
</div>
<div class="section" id="batch-update">
<h3>Batch Update</h3>
<pre><code><span class="k">with</span> <span class="n">table</span><span class="o">.</span><span class="n">batch_writer</span><span class="p">()</span> <span class="k">as</span> <span class="n">batch</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;test</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">begins_with</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">([(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">])</span>
<span class="c1"># -&gt; [(&quot;test0&quot;, 20), (&quot;test1&quot;, 21), (&quot;test2&quot;, 22)]</span></code></pre>
</div>
<div class="section" id="batch-delete">
<h3>Batch Delete</h3>
<pre><code><span class="n">pks</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">begins_with</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">),</span> <span class="n">pk_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">with</span> <span class="n">table</span><span class="o">.</span><span class="n">batch_writer</span><span class="p">()</span> <span class="k">as</span> <span class="n">batch</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">pks</span><span class="p">:</span>
        <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">delete_by_pk</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">begins_with</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1"># -&gt; []</span></code></pre>
</div>
</div>
<div class="section" id="relationship">
<h2>Relationship</h2>
<div class="section" id="create-model">
<h3>Create Model</h3>
<p>You can sat relationns to other models <span class="docutils literal">relation=BaseModel</span> to set
relation.</p>
<pre><code><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">__model_name__</span> <span class="o">=</span> <span class="s2">&quot;blogpost&quot;</span>
    <span class="n">__table__</span><span class="o">=</span><span class="n">table</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">DBField</span><span class="p">(</span><span class="n">unique_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">DBField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">DBField</span><span class="p">(</span><span class="n">reletion</span><span class="o">=</span><span class="n">User</span><span class="p">)</span></code></pre>
</div>
<div class="section" id="id1">
<span id="create-item-1"></span><h3>Create Item</h3>
<pre><code><span class="n">blogpost</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span>
    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;Hello world&quot;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span>
<span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">blogpost</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">()</span></code></pre>
<p>Then, tha value ?reletion item? added</p>
<table>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr><th class="head"><p>pk</p></th>
<th class="head"><p>sk</p></th>
<th class="head"><p>data</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>title</p></th>
<th class="head"><p>author</p></th>
<th class="head"><p>content</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>user_xxxx</p></td>
<td><p>user_item</p></td>
<td></td>
<td><p>John</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>user_xxxx</p></td>
<td><p>search_user_name</p></td>
<td><p>John</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>blogpost_xxxx</p></td>
<td><p>blogpost_item</p></td>
<td></td>
<td></td>
<td><p>Hello</p></td>
<td><p>John</p></td>
<td><p>Hello world</p></td>
</tr>
<tr><td><p>blogpost_xxxx</p></td>
<td><p>search_blogpost_title</p></td>
<td><p>Hello</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>blogpost_xxxx</p></td>
<td><p>rel_user_xxxx</p></td>
<td><p>author</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>In addition to main item (sk=<span class="docutils literal">blogpost_item</span>), relation item
(sk=<span class="docutils literal">rel_{primary_key}</span>) added to table. The GSI <span class="docutils literal">DataSearchIndex</span>
is used to get ?relation items? to extract target?s pk. Then,
<span class="docutils literal">batch_get</span> items by pk.</p>
<table>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr><th class="head"><p>sk = hash</p></th>
<th class="head"><p>data = range</p></th>
<th class="head"><p>pk</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>rel_user_xxxx</p></td>
<td><p>author</p></td>
<td><p>blogpost_xxxx</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="search-relations">
<h3>Search Relations</h3>
<p><span class="docutils literal">get_relation(model=Basemodel)</span> to search relations</p>
<pre><code><span class="n">blogpost</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">BlogPost</span><span class="p">)</span><span class="o">.</span><span class="n">get_by_unique</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="n">blogpost</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">(</span><span class="o">**</span><span class="n">blogpost</span><span class="p">)</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">blogpost</span><span class="p">)</span><span class="o">.</span><span class="n">get_relation</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">User</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="c1"># -&gt; [{&quot;pk&quot;:&quot;user_xxxx&quot;, &quot;sk&quot;:&quot;user_item&quot;, &quot;name&quot;:&quot;John&quot;}]</span></code></pre>
<p>Also <span class="docutils literal">get_relation(field=DBField)</span> to specify field</p>
<pre><code><span class="n">user</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">blogpost</span><span class="p">)</span><span class="o">.</span><span class="n">get_relation</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="c1"># -&gt; [{&quot;pk&quot;:&quot;user_xxxx&quot;, &quot;sk&quot;:&quot;user_item&quot;, &quot;name&quot;:&quot;John&quot;}]</span></code></pre>
</div>
<div class="section" id="search-reference">
<h3>Search Reference</h3>
<p>In this library, ?reference? is antonym to relation</p>
<p><span class="docutils literal">get_reference(model=Basemodel)</span> to search items related to the item</p>
<pre><code><span class="n">user</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">get_by_unique</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="o">**</span><span class="n">blogpost</span><span class="p">)</span>

<span class="n">blogpost</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">blogpost</span><span class="p">)</span><span class="o">.</span><span class="n">get_reference</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">BlogPost</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">blogpost</span><span class="p">)</span>
<span class="c1"># -&gt; [{&quot;pk&quot;:&quot;blogpost_xxxx&quot;, &quot;sk&quot;:&quot;blogpost_item&quot;, &quot;name&quot;:&quot;Hello&quot;}]</span></code></pre>
<p>Also <span class="docutils literal">get_reference(field=DBField)</span> to specify field</p>
<pre><code><span class="n">blogpost</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">get_reference</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">blogpost</span><span class="p">)</span>
<span class="c1"># -&gt; [{&quot;pk&quot;:&quot;blogpost_xxxx&quot;, &quot;sk&quot;:&quot;blogpost_item&quot;, &quot;name&quot;:&quot;Hello&quot;}]</span></code></pre>
</div>
<div class="section" id="update-relation">
<h3>Update Relation</h3>
<p>If relation key?s value changed, relationship also changed.</p>
<pre><code><span class="n">new_user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Michael&quot;</span><span class="p">)</span>
<span class="n">blogpost</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">BlogPost</span><span class="p">)</span><span class="o">.</span><span class="n">get_by_unique</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="n">blogpost</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_user</span>
<span class="n">blogpost</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">(</span><span class="o">**</span><span class="n">blogpost</span><span class="p">)</span>

<span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">blogpost</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></code></pre>
<p>Then, ?reletion item? changed</p>
<table>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr><th class="head"><p>pk</p></th>
<th class="head"><p>sk</p></th>
<th class="head"><p>data</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>title</p></th>
<th class="head"><p>author</p></th>
<th class="head"><p>content</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>user_xxxx</p></td>
<td><p>user_item</p></td>
<td></td>
<td><p>John</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>user_xxxx</p></td>
<td><p>search_user_name</p></td>
<td><p>John</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>user_yyyy</p></td>
<td><p>user_item</p></td>
<td></td>
<td><p>Michael</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>user_yyyy</p></td>
<td><p>search_user_name</p></td>
<td><p>Michael</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>blogpost_xxxx</p></td>
<td><p>blogpost_item</p></td>
<td></td>
<td></td>
<td><p>Hello</p></td>
<td><p>Michael</p></td>
<td><p>Hello world</p></td>
</tr>
<tr><td><p>blogpost_xxxx</p></td>
<td><p>search_blogpost_title</p></td>
<td><p>Hello</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>blogpost_xxxx</p></td>
<td><p>rel_user_yyyy</p></td>
<td><p>author</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="delete-relation">
<h3>Delete Relation</h3>
<p>If related item deleted, relationship also deleted</p>
<pre><code><span class="n">query</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">delete_by_unique</span><span class="p">(</span><span class="s2">&quot;Michael&quot;</span><span class="p">)</span></code></pre>
<p>Then, ?reletion item? deleted. But main item?s value is not chenged.</p>
<table>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr><th class="head"><p>pk</p></th>
<th class="head"><p>sk</p></th>
<th class="head"><p>data</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>title</p></th>
<th class="head"><p>author</p></th>
<th class="head"><p>content</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>user_xxxx</p></td>
<td><p>user_item</p></td>
<td></td>
<td><p>John</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>user_xxxx</p></td>
<td><p>search_user_name</p></td>
<td><p>John</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr><td><p>blogpost_xxxx</p></td>
<td><p>blogpost_item</p></td>
<td></td>
<td></td>
<td><p>Hello</p></td>
<td><p>Michael</p></td>
<td><p>Hello world</p></td>
</tr>
<tr><td><p>blogpost_xxxx</p></td>
<td><p>search_blogpost_title</p></td>
<td><p>Hello</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>

